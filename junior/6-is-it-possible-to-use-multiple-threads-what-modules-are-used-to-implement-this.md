### Чи можливо використовувати кілька потоків у Node.js?

Так, у Node.js можливо використовувати кілька потоків для виконання задач. Хоча Node.js спочатку був розроблений як однопотокова платформа, він підтримує багатопоточність через модулі, такі як **Worker Threads**.

#### **Основні механізми багатопоточності в Node.js**

1. **Worker Threads**:
    - **Що це?**: Модуль, який дозволяє створювати багатопоточні задачі в Node.js.
    - **Коли використовувати?**: Для обчислювально складних завдань, які можуть блокувати основний потік.
    - **Особливості**:
        - Кожен потік (worker) має власний цикл подій і пам'ять.
        - Взаємодія між потоками здійснюється через обмін повідомленнями (message passing).
    - **Приклад використання**:
      ```javascript
      const { Worker } = require('worker_threads');
 
      if (require.main === module) {
        const worker = new Worker(__filename, { workerData: { num: 42 } });
 
        worker.on('message', (result) => {
          console.log('Result from worker:', result);
        });
 
        worker.on('error', (err) => console.error('Worker error:', err));
      } else {
        const { workerData, parentPort } = require('worker_threads');
        // Виконання важкої операції
        const result = workerData.num * 2;
        parentPort.postMessage(result);
      }
      ```

---

2. **Cluster API**:
    - **Що це?**: Модуль для розподілу завантаження між кількома процесами (форками).
    - **Коли використовувати?**: Для масштабування додатків, щоб використовувати всі ядра CPU.
    - **Особливості**:
        - Кожен процес має свій власний потік подій.
        - Додаток може приймати запити паралельно через кілька процесів.
    - **Приклад використання**:
      ```javascript
      const cluster = require('cluster');
      const http = require('http');
      const os = require('os');
 
      if (cluster.isPrimary) {
        const numCPUs = os.cpus().length;
 
        console.log(`Primary process ${process.pid} is running`);
 
        // Створення воркерів
        for (let i = 0; i < numCPUs; i++) {
          cluster.fork();
        }
 
        cluster.on('exit', (worker, code, signal) => {
          console.log(`Worker ${worker.process.pid} exited`);
        });
      } else {
        http.createServer((req, res) => {
          res.writeHead(200);
          res.end('Hello from worker!\n');
        }).listen(8000);
 
        console.log(`Worker process ${process.pid} started`);
      }
      ```

---

3. **Child Processes**:
    - **Що це?**: Модуль, який дозволяє створювати окремі процеси для виконання задач.
    - **Коли використовувати?**: Для виконання задач у зовнішніх процесах або скриптах.
    - **Типи виконання**:
        - `spawn`: Для запуску команди в новому процесі.
        - `fork`: Для створення дочірнього процесу з доступом до Node.js модулів.
        - `exec`: Для виконання команди в оболонці.
    - **Приклад використання**:
      ```javascript
      const { fork } = require('child_process');
 
      const child = fork('child.js'); // Дочірній скрипт
 
      child.on('message', (msg) => {
        console.log('Message from child:', msg);
      });
 
      child.send({ task: 'start' });
      ```

---

#### **Порівняння підходів**

| Механізм        | Особливості                                                                                     | Підходить для                               |
|------------------|------------------------------------------------------------------------------------------------|---------------------------------------------|
| Worker Threads   | Використовує багатопоточність у межах одного процесу Node.js.                                   | Обчислювально складні задачі.               |
| Cluster API      | Дозволяє використовувати всі ядра CPU, розподіляючи навантаження між процесами.                 | Масштабування серверних додатків.           |
| Child Processes  | Запуск зовнішніх скриптів або програм у нових процесах.                                         | Інтеграція зі сторонніми програмами.        |

---

#### **Висновок**
Node.js підтримує багатопоточність через **Worker Threads** для задач із високими обчислювальними вимогами та **Cluster API** для масштабування додатків. Ці інструменти дозволяють ефективно використовувати потужність багатоядерних процесорів, забезпечуючи продуктивність і гнучкість.


| Попереднє питання                                                                                                                                                                                                                              | Наступне питання                                                                                      |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------|
| [Яким чином Node.js сервер здатен обробляти одночасно багато паралельних запитів від клієнтів, маючи лише один thread?](5-how-is–a-node-js-server-able-to-handle-many-parallel-requests-from-clients-at-the-same-time-with-only-one-thread.md) | [Node.js інтерпретує чи компілює код програми?](7-does-node-js-interpret-or-compile-program-code.md)  |
