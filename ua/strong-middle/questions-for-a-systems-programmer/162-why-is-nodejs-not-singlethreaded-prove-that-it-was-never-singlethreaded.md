#### 162. Чому Node.js не однопотоковий? Доведіть, що він ніколи не був однопотоковим?

Node.js часто називають однопотоковою середовищем виконання JavaScript через його модель програмування, яка ґрунтується на однопотоковій подіях, без блокування. Однак це твердження не зовсім точне. Давайте розглянемо, чому Node.js не є однопотоковим і як це працює насправді.

### Неоднопотоковість в Node.js

1. **Архітектура Node.js**:
   Node.js використовує цикл подій (event loop) для обробки асинхронних завдань. Головний потік дійсно є однопотоковим і займається обробкою JavaScript-коду та керуванням подіями. Але сам Node.js базується на бібліотеці libuv, яка насправді використовує пул потоків для деяких операцій.

2. **Блокуючі операції**:
   Попри те, що JavaScript дійсно виконується в однопоточному режимі, операції введення-виведення (I/O), такі як операції роботи з файлами, мережеве взаємодія, роботи з базами даних та інші системні виклики, виконуються у пулі потоків. Це забезпечує неблокуючий підхід, оскільки ці операції звичайно більш ресурсомісткі і часозатратні.

3. **Worker Threads**:
   Починаючи з версії Node.js 10.5.0, з'явилася підтримка Worker Threads, що дозволяє запускати JavaScript-код у фонових потоках, відокремлених від основного потоку. Це ще раз підкреслює багатопоточність в можливостях Node.js.

### Доведення

- **libuv**: Ця бібліотека реалізує пул потоків, зазвичай з 4 потоками за замовчуванням, для виконання неблокуючих задач. Це означає, що операції I/O, такі як файлова система та DNS-запити, можуть виконуватись в інших потоках, не блокуючи основний цикл подій.

- **Addons**: Node.js допускає написання C/C++ аддонів, в яких програміст може самостійно управляти потоками, тим самим ще більше розширюючи можливості по виконанню задач в багатопоточному режимі.

Таким чином, хоча Node.js зазвичай програмується з використанням однопотокової моделі за рахунок циклу подій, насправді під капотом він використовує багатопоточні технології для оптимізації і прискорення виконання завдань.

| Back | Forward |
|---|---|
| [Які ви знаєте вбудовані засоби серіалізації у Node.js, аналогічні до JSON, але для бінарної серіалізації?](/ua/strong-middle/questions-for-a-systems-programmer/what-native-serialization-tools-in-nodejs-do-you-know-that-are-similar-to-json-but-for-binary-serialization.md)  | [Чим замінити deprecated: fs.exists?](/ua/strong-middle/questions-for-a-systems-programmer/what-to-replace-deprecated-fsexists.md) |