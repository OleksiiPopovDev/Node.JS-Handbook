#### * Analyze event loop behavior

В Node.js, подія надає асинхронну архітектуру, яка дозволяє виконувати операції вводу-виводу без блокування головного потоку. Подія створює ілюзію багатопоточності в середовищі з одинарним потоком виконання. Це здійснюється завдяки "Івент Луп" (Event Loop), який керує та обробляє асинхронні виклики.

### Поведінка Event Loop

#### Основні фази Event Loop:
1. **Timers (Таймери):** На цьому етапі виконуються зворотні виклики (callbacks), заплановані функціями `setTimeout()` та `setInterval()`, час яких сплив.

2. **Pending Callbacks (Очікуючі зворотні виклики):** Обробляються зворотні виклики для деяких системних операцій, наприклад помилки TCP сокета.

3. **Idle, prepare (Простій, підготовка):** Внутрішній цикл Node.js використовується в основному для внутрішніх процесів.

4. **Poll (Опитування):** На цьому етапі Event Loop обробляє нові ввідно-вивідні події; відправляє виклики у рядок виконання та спить в очікуванні нових подій, якщо потрібно.

5. **Check (Перевірка):** В даному етапі виконується обробка зворотніх викликів для `setImmediate()`.

6. **Close Callbacks (Закриття зворотних викликів):** Тут відбувається обробка закриття зворотних викликів, наприклад `socket.on('close')`.

### Асинхронність та неблокуючі операції

Асинхронність в Node.js досягається через неблокуючі операції вводу-виводу. Наприклад, функція `fs.readFile()` не блокує виконання коду. Замість цього вона реєструє зворотний виклик у події і продовжує виконання програми. Як тільки файл прочитаний, зворотний виклик ставиться в чергу на виконання в відповідній фазі Event Loop.

### Приклад роботи з Event Loop

```javascript
setTimeout(() => {
  console.log('Timeout 1');
}, 0);

setImmediate(() => {
  console.log('Immediate 1');
});

process.nextTick(() => {
  console.log('Next Tick');
});

console.log('Start');

/* Результат може бути таким:
   Start
   Next Tick
   Immediate 1
   Timeout 1
*/
```

В цьому прикладі спочатку виконується `console.log('Start')`. Далі функція `process.nextTick()` буде виконана негайно після поточної операції. Функція `setImmediate()` виконується в фазі "Перевірка", а `setTimeout()` — у фазі "Таймери".

### Висновок

Node.js Event Loop дозволяє ефективно керувати асинхронними операціями без традиційного багатопотокового підходу, що робить його ідеальним для яскравих та швидкодіючих додатків вводу-виводу, таких як веб-сервери або додатки реального часу. Розуміння поведінки Event Loop є ключовим для оптимізації і відлагодження коду Node.js.

| Back | Forward |
|---|---|
| [Secure Node.js applications (e.g., helmet.js, sanitization libraries)](/ua/senior/nodejs/secure-nodejs-applications.md)  | [Design advanced task prioritization](/ua/senior/nodejs/design-advanced-task-prioritization.md) |