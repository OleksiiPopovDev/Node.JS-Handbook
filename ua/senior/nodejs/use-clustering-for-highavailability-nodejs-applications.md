#### * Use clustering for high-availability Node.js applications

Для забезпечення високої доступності Node.js застосувань можна використовувати кластеризацію, яка дозволяє розподілити навантаження між кількома процесами. Це досягається шляхом використання вбудованого модуля `cluster`, який дозволяє створити кілька процесів з однієї і тієї ж Node.js програми, тим самим використовувати всі доступні ядра процесора. Ось як це можна реалізувати:

```javascript
const cluster = require('cluster');
const http = require('http');
const numCPUs = require('os').cpus().length;

if (cluster.isMaster) {
  console.log(`Master ${process.pid} is running`);

  // Створюємо воркери для кожного ядра
  for (let i = 0; i < numCPUs; i++) {
    cluster.fork();
  }

  cluster.on('exit', (worker, code, signal) => {
    console.log(`worker ${worker.process.pid} died`);
    // Тут можна запустити новий воркер замість того, який припинив роботу
    cluster.fork();
  });

} else {
  // Воркери можуть ділити будь-яке TCP-з'єднання.
  // У цьому випадку HTTP-сервер
  http.createServer((req, res) => {
    res.writeHead(200);
    res.end('hello world\n');
  }).listen(8000);

  console.log(`Worker ${process.pid} started`);
}
```

### Як це працює:
1. **Майстер-процес:** Контролює створення та ведення робочих процесів (воркерів).
2. **Воркери:** Кожен воркер обробляє запити окремо від інших, дозволяючи програмі використовувати всі доступні ядра вашого процесора.
3. **Обробка збоїв:** Якщо один з воркерів припиняє свою роботу (наприклад, через помилку), майстер-процес може створити новий воркер, щоб забезпечити безперебійну роботу.

### Переваги:
- **Підвищена продуктивність:** Завдяки використанню всіх ядер CPU.
- **Висока надійність:** Можливість автоматичного перезапуску воркерів у разі їхньої несправності.

### Обмеження:
- Сесії не зберігаються між воркерами. Якщо ваш додаток залежить від сесій, можливо, вам знадобиться використовувати спільне сховище сесій, наприклад Redis.
- Розподіл навантаження все ще обмежується межами одного сервера.

Цей підхід допомагає підвищити доступність та швидкість обробки запитів Node.js застосувань за рахунок паралелізації обробки запитів.

| Back | Forward |
|---|---|
| [Handle distributed systems communication in Node.js](/ua/senior/nodejs/handling-distributed-systems-communication-in-nodejs.md)  | [Contribute to the Node.js ecosystem](/ua/senior/nodejs/join-the-nodejs-community.md) |