#### 220. Що таке graceful shutdown? Як його імплементувати?

### Що таке Graceful Shutdown?

**Graceful Shutdown** — це процес коректного завершення роботи програми або сервісу, при якому система намагається мінімізувати вплив на інші частини системи, а також гарантує, що всі поточні операції або транзакції завершаться належним чином до закриття. Це дозволяє уникнути втрати даних, пошкодження файлів або неповних змін.

### Як імплементувати Graceful Shutdown?

1. **Перехоплення Сигналів:**
   - Для UNIX-систем зазвичай використовуються сигнали, такі як `SIGINT` або `SIGTERM`.
   - В мовах програмування, таких як Java, Go, Node.js, є можливість перехоплювати ці сигнали і відповідним чином реагувати на них.

2. **Зупинка Прийому Нових Завдань:**
   - Сервери повинні припинити прийом нових запитів або з'єднань. Наприклад, у веб-серверах це може означати, що більше не приймаються нові HTTP-запити.

3. **Завершення Поточних Операцій:**
   - Дочекатися завершення всіх поточних обчислювальних процесів або транзакцій. Це може включати обробку запитів, транзакцій бази даних або інших критичних секцій коду.

4. **Очищення Ресурсів:**
   - Закриття всіх відкритих ресурсів, таких як файлові дескриптори, з'єднання з базою даних, мережеві сокети.

5. **Запис Логів:**
   - Рекомендується вести детальний журнал, щоб у разі помилок під час завершення можна було діагностувати проблему.

6. **Notification to Dependent Services:**
   - Якщо ваша програма залежить, або від неї залежать інші сервіси, може бути корисно надіслати їм повідомлення або скористатися системою моніторингу, щоб сигналізувати про те, що ваша система буде вимкнена.

7. **Тайм-аутна Запаска:**
   - Встановити таймер чи механізм, який гарантовано завершить процес у певний час, навіть якщо деякі операції не завершилися — це допомагає уникнути нескінченних зависань.

#### Простий приклад на Node.js:

```javascript
const express = require('express');
const app = express();

let server = app.listen(3000, () => {
  console.log('Server is running on port 3000');
});

process.on('SIGTERM', () => {
  console.log('SIGTERM signal received: closing HTTP server');
  server.close(() => {
    console.log('HTTP server closed');
    // Here you can execute cleanup operations
  });
});
```

Реалізація Graceful Shutdown може відрізнятися в залежності від типу застосунку або сервісу, але загальні принципи залишаються такими ж.

| Back | Forward |
|---|---|
| [Що таке CLS і де варто його використовувати?](/ua/senior/architecture/what-is-cls-and-where-should-it-be-used.md)  | [Наведіть приклади імплементації GoF патернів у Node.js і фреймворках.](/ua/senior/architecture/what-are-examples-of-implementing-gof-patterns-in-nodejs-and-frameworks.md) |