#### 66. Implement data migrations

### Реалізація міграцій даних

Міграції даних — це важлива частина управління базою даних, яка дозволяє змінювати її структуру у контрольований та безпечний спосіб. Вони є особливо корисними в умовах командної розробки, де зміни мають бути синхронізовані між усіма учасниками проекту та середовищами.

#### Основні принципи реалізації міграцій:

1. **Контроль версій**: 
   - Надійні інструменти, такі як Liquibase або Flyway, забезпечують контроль версій для міграцій, що дозволяє слідкувати за змінами у структурі БД.

2. **Атомарність змін**:
   - Кожна міграція повинна бути незалежною і мати конкретну задачу, наприклад, додавання або видалення стовпця.

3. **Ідемапотентність**:
   - Міграції написані так, що можуть бути виконані декілька разів без змінення поточного стану бази даних.

4. **Збереження даних**:
   - Для змін, які можуть призвести до втрати даних (наприклад, видалення стовпця), важливо спочатку перенести або зберегти дані в іншим чином.

#### Приклад реалізації міграцій за допомогою Flyway:

1. **Створення файлу міграції**:
   Назвіть файл у форматі `V{version_number}__{description}.sql`, наприклад, `V1__create_user_table.sql`.

2. **Приклад SQL-міграції**:
   ```sql
   CREATE TABLE users (
       id SERIAL PRIMARY KEY,
       username VARCHAR(50) NOT NULL UNIQUE,
       email VARCHAR(100) NOT NULL UNIQUE,
       created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
   );
   ```

3. **Налаштування Flyway**:
   Додайте конфігураційний файл `flyway.conf` з основними параметрами:
   ```properties
   flyway.url=jdbc:postgresql://localhost:5432/mydb
   flyway.user=myusername
   flyway.password=mypassword
   ```

4. **Запуск міграцій**:
   Використовуйте термінальну команду:
   ```bash
   flyway migrate
   ```

#### Поради:

- **Тестування**: Завжди тестуйте свої міграції на тестовій базі, перш ніж застосовувати їх у продуктивному середовищі.
- **Бекапи**: Виконуйте резервне копіювання бази даних перед виконанням міграцій, особливо якщо вони включають зміни, які не можуть бути скасовані.
- **Документація**: Документуйте кожну зміну, щоб полегшити розуміння еволюції бази даних для вас і вашої команди.

Міграції даних забезпечують гнучкість та стабільність у роботі з базами даних, дозволяючи швидко адаптуватись до нових вимог проекту.

| Back | Forward |
|---|---|
| [Understand ORM basics](/ua/junior/database/understand-objectrelational-mapping-fundamentals.md)  | [Filter and query tables](/ua/junior/database/how-to-filter-and-query-tables.md) |