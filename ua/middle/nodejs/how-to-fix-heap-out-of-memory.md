#### 98. Як налагодити heap out of memory?

Налагодження проблеми "heap out of memory" у Node.js передбачає різні підходи для виявлення та розв'язання проблеми з пам'яттю. Ось кілька кроків, які можуть допомогти:

1. **Збільшення Ліміту Пам'яті**:
   - За замовчуванням Node.js встановлює обмеження пам'яті на 1.5 ГБ. Щоб збільшити цей ліміт, можна запустити Node.js з параметром `--max_old_space_size`.
   - Приклад: `node --max_old_space_size=4096 your_script.js` - це дозволить використовувати до 4 ГБ пам'яті.

2. **Профілювання Завантаження Пам'яті**:
   - Використовуйте інструменти, такі як `heapdump` або `node-inspect`, для отримання дампів купи (heap dumps).
   - Проаналізуйте ці дані за допомогою інструментів, таких як Chrome DevTools або `Visual Studio Code`, щоб визначити, які об'єкти займають найбільше пам'яті.

3. **Використання Інструментів Моніторингу**:
   - Інтегруйте інструменти моніторингу, такі як `pm2`, `New Relic`, або `AppDynamics`, для відстеження використання пам'яті в реальному часі.

4. **Аналіз Витікань Пам'яті**:
   - Витікання пам'яті можуть статися через незакриті таймери, збережені зворотні виклики або незвільнені ресурси.
   - Використовуйте `clinic.js` або `memwatch-next` для виявлення витікань.

5. **Поліпшення Кодека При Створенні Об'єктів**:
   - Перевірте частини коду, які створюють багато об'єктів. Розгляньте можливість їх переробки для економії пам'яті.

6. **Перевірка Зовнішніх Бібліотек**:
   - Іноді проблеми з пам'яттю можуть виходити від сторонніх пакетів. Спробуйте видалити або оновити їх до останніх версій.

7. **Запуск Garbage Collector вручну для Тестування**:
   - Запустіть вашу програму з параметром `--expose-gc` і періодично викликайте `global.gc()`, щоб примусово очистити сміття вручну. Це лише для діагностики і не рекомендовано в продуктивному середовищі.

8. **Оптимізація Роботи з Масивами та Колекціями**:
   - Переконайтеся, що вибіркове використання структур даних є оптимальним та не витрачає зайвий обсяг пам'яті.

Таким чином, проблема з "heap out of memory" зазвичай вирішується шляхом комбінації налаштувань параметрів запуску, оптимізації коду та використання інструментів для виявлення та вирішення витікань пам'яті.

| Back | Forward |
|---|---|
| [Що означає «витік пам’яті» процеса? Як цьому запобігти?](/ua/middle/nodejs/what-is-a-memory-leak-in-a-process-and-how-can-it-be-prevented.md)  | [Як налаштувати кешування?](/ua/middle/nodejs/how-to-configure-caching.md) |