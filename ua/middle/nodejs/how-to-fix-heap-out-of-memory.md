#### 78. Як налагодити heap out of memory?

Помилка "heap out of memory" зазвичай виникає, коли програма перевищує доступну їй пам'ять купи (heap memory). Ось кілька кроків, які допоможуть вирішити цю проблему:

1. ### Збільшення розміру пам'яті купи:
   - Для Node.js ви можете збільшити розмір пам'яті купи, використовуючи параметр `--max-old-space-size`. Наприклад, щоб збільшити до 4 ГБ:  
     ```bash
     node --max-old-space-size=4096 your_script.js
     ```

2. ### Оптимізація коду:
   - **Уникайте витоків пам'яті:** Перевірте свій код на наявність витоків пам'яті, що можуть призводити до поступового заповнення купи.
   - **Очищення неактуальних даних:** Звільняйте пам'ять, яка більше не використовується. Використовуйте `WeakMap` або `WeakSet` для зберігання даних, коли це можливо.
   - **Лінива ініціалізація:** Ініціалізуйте ресурси лише тоді, коли вони дійсно потрібні.

3. ### Аналіз та діагностика:
   - **Профілювання пам'яті:** Використовуйте інструменти профілювання, такі як Chrome DevTools або `node --inspect`, щоб детально аналізувати використання пам'яті.
   - **Логи та моніторинг:** Створюйте логи для відстеження споживання пам'яті та встановлюйте інструменти моніторингу для довготривалих проєктів.

4. ### Інші можливості:
   - **Використання потоків:** Розбивайте великі обчислення на дрібніші завдання за допомогою `worker threads` або інших механізмів паралельного виконання.
   - **Зберігання даних на диску:** Переносьте великі об'єми даних у тимчасові файли або бази даних, якщо вони не потрібні постійно в оперативній пам'яті.
   - **Оновлення та патчі:** Переконайтесь, що використовуєте актуальні версії залежностей та інструментів, оскільки вони можуть містити виправлення відомих проблем з пам'яттю.

Дотримуючись цих рекомендацій, ви зможете уникнути помилки "heap out of memory" та забезпечити стабільну роботу вашого додатку.

| Back | Forward |
|---|---|
| [Що означає «витік пам’яті» процеса? Як цьому запобігти?](/ua/middle/nodejs/what-is-a-memory-leak-and-how-can-it-be-prevented.md)  | [Як налаштувати кешування?](/ua/middle/nodejs/how-to-configure-caching.md) |